<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Aid Transparency Tracker</title>
    <link href="/plan/static/bootstrap-responsive.css" media="all" rel="stylesheet" type="text/css" />
    <link href="/plan/static/css/bootstrap.css" media="all" rel="stylesheet" type="text/css" />
    <script src="/plan/static/vendor/jquery/1.7.1/jquery.js" type="text/javascript"></script>
    <script src="/plan/static/bootstrap.min.js" type="text/javascript"></script>
    <script src="/plan/static/d3.v2.min.js" type="text/javascript"></script>
    <link href="/plan/static/style.css" media="all" rel="stylesheet" type="text/css" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-18679634-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</head>
<body>

    <div class="navbar navbar-static-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Aid Transparency Tracker</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
            	<li class="active"><a href="/">Home</a></li>
                <li ><a href="/plan/">Plan</a></li>
                <li ><a href="/publish/">Publish</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
<style>
.highlight-yellow {
    background-color: yellow;
}
.recline-timeline .vmm-timeline, .data-views .recline-map .map {
    height: 400px;
}
</style>


 <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/plan/static/css/timeline.css">


  <!-- 3rd party JS libraries -->
  <script type="text/javascript" src="/plan/static/vendor/jquery/1.7.1/jquery.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/underscore/1.4.2/underscore.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/underscore.deferred/0.4.0/underscore.deferred.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/backbone/0.9.2/backbone.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/moment/1.6.2/moment.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/mustache/0.5.0-dev/mustache.js"></script>
  <script type="text/javascript" src="/plan/static/vendor/timeline/20120520/js/timeline.js"></script>

  <script type="text/javascript" src="/plan/static/src/backend.json.js"></script>
  <script type="text/javascript" src="/plan/static/src/backend.memory.js"></script>

  <script type="text/javascript" src="/plan/static/src/view.timeline.js"></script>
  <script type="text/javascript" src="/plan/static/src/model.js"></script>

  <style>
    a.btn-timeline {
        -moz-border-bottom-colors: none;
        -moz-border-left-colors: none;
        -moz-border-right-colors: none;
        -moz-border-top-colors: none;
        background-color: #F5F5F5;
        background-image: linear-gradient(to bottom, #FFFFFF, #E6E6E6);
        background-repeat: repeat-x;
        border-color: rgba(0, 0, 0, 0.1) rgba(0, 0, 0, 0.1) #B3B3B3;
        border-image: none;
        border-radius: 4px 4px 4px 4px;
        border-style: solid;
        border-width: 1px;
        box-shadow: 0 1px 0 rgba(255, 255, 255, 0.2) inset, 0 1px 2px rgba(0, 0, 0, 0.05);
        color: #333333;
        cursor: pointer;
        display: inline-block;
        font-size: 14px;
        line-height: 20px;
        margin-bottom: 0;
        padding: 4px 12px;
        text-align: center;
        text-shadow: 0 1px 1px rgba(255, 255, 255, 0.75);
        vertical-align: middle;
    }
    .recline-timeline .btn:hover, .recline-timeline .btn:focus {
        background-position: 0 -15px;
        color: #333333 !important;
        text-decoration: none !important;
        transition: background-position 0.1s linear 0s;
    }
    .recline-timeline .btn:hover, .recline-timeline .btn:focus, .recline-timeline .btn:active, .recline-timeline .btn.active, .recline-timeline .btn.disabled, .recline-timeline .btn[disabled]  {
        background-color: #E6E6E6;
        color: #333333;
    }
    </style>

    <div class="jumbotron masthead masthead-tracker-home">
    <div class="container">
    <h1>Plan. <span class="black">Publish.</span></h1>
    <p class="lead">Donors are beginning to publish more information about their aid activities.</p>
    <p class="lead">Find out <a href="plan/">what's coming</a>, and <a href="publish/">what's already available</a>.</p>
    </div>
    </div>
    <div class="container">
    <div class="alert alert-error">
	<p><b>Error 404: File Not Found</b> &ndash; the page you requested could not be found, so we've redirected you to the new Tracker home page.</p>
    </div>

    <div class="row">
    <h3>Now including publication data</h3>
    <p class="lead">We've just added <a href="publish/">data on the quality of donors' publication</a>. All donors are being provided with the opportunity to check and comment on this initial assessment, which will feed into the Aid Transparency Index to be published in October 2013.</p>
    </div>
    <hr />
    <div class="row">
        <div class="span6">
            <h1>Organisations</h1>
            <p class="lead">See plans from individual organisations</p>
            <p>
            <a class="btn btn-primary" href="/plan/organisations/">Organisations »</a>
            </p>
        </div>
        <div class="span6">
            <h1>Fields</h1>
            <p class="lead">See data fields across all organisations' plans</p>
            <p>
            <a class="btn btn-primary" href="/plan/fields/">Fields »</a>
            </p>
        </div>
    </div>
    <div class="row">
        <div class="span6">
            <h1>Timeline</h1>
            <p class="lead">Use the timeline to see a graph of publication over time for different fields</p>
            <p>
            <a class="btn btn-primary" href="/plan/timeline/">Timeline »</a>
            </p>
        </div>
        <div class="span6">
            <h1>Report</h1>
            <p class="lead">Download a report containing our initial analysis</p>
            <p>
            <a class="btn btn-primary" href="http://www.publishwhatyoufund.org/files/2013/03/Comparative-analysis-of-the-common-standard-implementation-schedules-Mar-13.docx">Get the report »</a>
            </p>
        </div>
    </div>
    <hr />
    <div class="row-fluid">
        <div class="span12 data-views">
          <center><h3>Initial implementation</h3></center>
          <div class="timeline"></div>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
          <p>&nbsp;</p>
        </div>
    </div>

<script type="text/javascript">jQuery(function($) {
    
  var url = "/plan/api/publishers/data/publishing_timetable_date_initial/";
  var dataset = new recline.Model.Dataset({
      url:url,
      fields: [
          {id: 'date', type: 'date', label:"Date"},
          {id: 'organisation_name', type: 'string', label: "Organisation"},
          {id: 'organisation_code', type: 'string', label: "Organisation"}
        ],
      backend:'json'
    });
  var timeliner = new TimelinerView({
    model: dataset,
    el: $('.data-views')
  });
  timeliner.render();
});

var TimelinerView = Backbone.View.extend({
  events: {
    'click .controls .js-show-toolbox': '_onShowToolbox',
    'submit .toolbox form': '_onSearch'
  },

  _onShowToolbox: function(e) {
    e.preventDefault();
    if (this.$el.find('.toolbox').hasClass('hideme')) {
      this.$el.find('.toolbox').removeClass('hideme');
    } else {
      this.$el.find('.toolbox').addClass('hideme');
    }
  },

  _onSearch: function(e) {
    e.preventDefault();
    var query = this.$el.find('.text-query input').val();
    this.model.query({q: query});
  },

  render: function() {
    var self = this;
    // explicitly set width as otherwise Timeline does extends a bit too far (seems to use window width rather than width of actual div)
    // $el.width((this.el.width() - 45)/2.0);
    this.timeline = new recline.View.Timeline({
      model: this.model,
      el: this.$el.find('.timeline')
    });
    
    this.timeline.convertRecord = function(record, fields) {
        var out = this._convertRecord(record);
        if (out) {
            out.headline = record.get('organisation_name').toString();
            out.text = "Initial implementation";
            out.text += '<p><a class="btn btn-timeline" href="/plan/organisations/' + record.get('organisation_code') + '">Organisation page &raquo;</a></p>';
        }
        return out;
    }
    this.timeline.render();
    
    this.model.fetch();

  }
});


</script>  </div>
    <footer class="footer">
    <div class="container">
        <p><a href="http://publishwhatyoufund.org"><img src="/plan/static/img/pwyf_small.png" alt="A project of Publish What You Fund"></a></p>
	<p>All source code on Github; released under the <a href="http://www.gnu.org/licenses/agpl-3.0.html">AGPL v3.0 License</a>.</p>
    </div></footer>
</body>
</html>

